<!DOCTYPE html>
<html lang="zh-CN">
<head>
<title>横向滑动</title>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style type="text/css">
    html {width:100%; height:100%;}
    body {width:100%; height:100%; margin: 0; color:#000;
        font:normal 16px/1.8em "WenQuanYi Micro Hei", "Microsoft Yahei",sans-serif, Arial;
    }
    .wrapper {width: 100%; height:100%; overflow: hidden; position: relative;}
    .boxwrap {
        position: absolute; height: 100%; width:100%;
    }
    .boxwrap div {
        height:100%; display: inline-block; vertical-align:top;
        text-align: center;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
    }

    .boxwrap .active { }
    .boxwrap div:nth-child(odd) {background-color: #d5d5d5;}
    .info {text-align: left; width: 80%; margin: 0 auto;}
</style>
</head>

<body>

<div class="wrapper">
    <div id="boxwrap" class="boxwrap">
        <div>
            <h1>1</h1>
            <h2>鼠标或手指向左滑动</h2>
            <p class="info">完整样例代码文件请至：<a href="https://github.com/taoland/simple-swipe-slider">https://github.com/taoland/simple-swipe-slider</a><br />
            <strong>1.主文件：</strong><br />
                follow-touch-slider-landscape.html 横向滑动版 <br />follow-touch-slider-vertical.html 竖向滑动版 style.css 样式文件<br />

            <strong>2.不jquery依赖的javascript版本：</strong><br />

                demo-no-jquery-slider.html<br />

            <strong>3.gallery DEMO，</strong>大图和缩略图上下都可联动：<br />

                demo-gallery.html gallery.css<br />

            <strong>4.其他：</strong><br />

                follow-touch-square.html 小方块跟随touch事件的demo
            </p>
        </div>
        <div><h2>2</h2></div>
        <div><h2>3</h2></div>
        <div><h2>4</h2></div>
        <div><h2>5</h2></div>
    </div>
</div>

<script src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript">
// define global variable
var $win = $(window);
var winW = $win.width(),
    $boxwrap = $("#boxwrap"),
    $boxs = $boxwrap.find('div'),
    theIndex = 0,
    boxLength = $boxs.length,
    xStart,
    moveVal = 0,
    wrapMoveVal = null,
    lastMoveVal = 0,
    moveFlag = false,
    lastTouchTime = 0,
    defaultGap = 300, //翻页的最小间隔时间，阻止翻页太快
    theGaptime;

$boxwrap.width(boxLength*winW);
$boxs.width(winW);
//jquery .on()
$boxs.on("touchstart touchend touchmove mousedown mouseup mousemove", swipeAction);

function swipeAction(event){
    event = event.originalEvent;
    var $this = $(this);
    switch(event.type){
        case "touchstart":
            event.preventDefault();
            xStart = event.touches[0].clientX;
            moveFlag = true;
            theIndex = $this.index();
            var touchStartDate = new Date();
            var touchStartTime = touchStartDate.getTime();
            theGaptime = touchStartTime-lastTouchTime;
            break;
        case "touchend":
            event.preventDefault();
            moveVal = event.changedTouches[0].clientX - xStart;//get moveVal again
            var lastDate = new Date();
            lastTouchTime = lastDate.getTime();
            if (theGaptime>defaultGap) {
                dragEnd();
            }
            break;
        case "touchmove":
            event.preventDefault();
            moveVal = event.changedTouches[0].clientX - xStart;//get moveVal
            //console.log(xStart,moveVal);
            if (moveFlag && theGaptime>defaultGap) {
                if (moveVal<0) {
                    wrapMoveVal = moveVal - winW*(theIndex);
                }else{
                    wrapMoveVal = - winW*theIndex + moveVal;
                }
                $boxwrap.css({
                    '-webkit-transform':'translate3d('+wrapMoveVal+'px,0,0)'
                });
            }
            break;
        case "mousedown":
            event.preventDefault();
            xStart = event.clientX;
            moveFlag = true;
            theIndex = $this.index();
            var touchStartDate = new Date();
            var touchStartTime = touchStartDate.getTime();
            theGaptime = touchStartTime-lastTouchTime;
            //console.log(theIndex);
            break;
        case "mouseup":
            event.preventDefault();
            moveVal = event.clientX - xStart;
            var lastDate = new Date();
            lastTouchTime = lastDate.getTime();
            if (theGaptime>defaultGap) {
                dragEnd();
            }
            break;
        case "mousemove":
            event.preventDefault();
            moveVal = event.clientX - xStart;
            //console.log(xStart,moveVal);
            if (moveFlag && theGaptime>defaultGap){
                if (moveVal<0) {
                    wrapMoveVal = moveVal - winW*(theIndex);
                }else{
                    wrapMoveVal = - winW*theIndex + moveVal;
                }
                $boxwrap.css({
                    '-webkit-transform':'translate3d('+wrapMoveVal+'px,0,0)'
                });
            }
        break;
    }
}

function dragEnd(){
    //console.log(moveVal);
    if (-moveVal > 30 && theIndex > -1 && theIndex < boxLength-1) { //向左划大于30
        $boxs.eq(theIndex+1).addClass('active').prev().removeClass('active');
        $boxwrap.css({
            'transition-duration': '300ms',
            '-webkit-transform':'translate3d('+ (-winW*(theIndex+1)) +'px,0,0)'
        })
    }else if (moveVal > 30 && theIndex > 0){
        $boxs.eq(theIndex-1).addClass('active').next().removeClass('active');
        $boxwrap.css({
            'transition-duration': '300ms',
            '-webkit-transform':'translate3d('+ -winW*(theIndex-1) +'px,0,0)'
        });
    }else {
        $boxwrap.css({
            'transition-duration': '300ms',
            '-webkit-transform':'translate3d('+ -winW*theIndex +'px,0,0)'
        });
    }
    moveFlag = false;
}

$boxwrap.on('webkitTransitionEnd transitionend',function(){
    $(this).css({
        'transition-duration': '0ms'
    })
});

</script>

</body>
</html>